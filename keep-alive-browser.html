<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ServiceGuru Keep-Alive</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
        }
        .status {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .success { border-left: 4px solid #4CAF50; }
        .error { border-left: 4px solid #f44336; }
        .info { border-left: 4px solid #2196F3; }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #45a049; }
        button:disabled { background: #666; cursor: not-allowed; }
        #log { max-height: 400px; overflow-y: auto; font-family: monospace; font-size: 12px; }
    </style>
</head>
<body>
    <h1>üöó ServiceGuru Keep-Alive Monitor</h1>
    <div class="status info">
        <strong>Target URL:</strong> https://garageguru-whh7.onrender.com<br>
        <strong>Ping Interval:</strong> Every 2 minutes<br>
        <strong>Status:</strong> <span id="status">Stopped</span>
    </div>
    
    <button id="startBtn" onclick="startKeepAlive()">Start Keep-Alive</button>
    <button id="stopBtn" onclick="stopKeepAlive()" disabled>Stop Keep-Alive</button>
    <button onclick="clearLog()">Clear Log</button>
    
    <div class="status">
        <strong>Activity Log:</strong>
        <div id="log"></div>
    </div>

    <div class="status info">
        <h3>Instructions:</h3>
        <ul>
            <li>Click "Start Keep-Alive" to begin monitoring</li>
            <li>Keep this browser tab open and active</li>
            <li>Your ServiceGuru app will stay alive on Render</li>
            <li>This prevents the 15-minute sleep timeout</li>
        </ul>
    </div>

    <script>
        const SERVICEGURU_URL = 'https://garageguru-whh7.onrender.com';
        const PING_INTERVAL = 2 * 60 * 1000; // 2 minutes
        let intervalId = null;
        let isRunning = false;

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logDiv = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = type;
            entry.innerHTML = `[${timestamp}] ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function updateStatus(status) {
            document.getElementById('status').textContent = status;
        }

        async function pingServiceGuru() {
            try {
                updateStatus('Pinging...');
                const response = await fetch(SERVICEGURU_URL, {
                    method: 'GET',
                    mode: 'no-cors', // Avoid CORS issues
                });
                
                log(`‚úÖ ServiceGuru pinged successfully`, 'success');
                updateStatus('Running - Last ping successful');
            } catch (error) {
                log(`‚ùå ServiceGuru ping failed: ${error.message}`, 'error');
                updateStatus('Running - Last ping failed');
            }
        }

        function startKeepAlive() {
            if (isRunning) return;
            
            isRunning = true;
            document.getElementById('startBtn').disabled = true;
            document.getElementById('stopBtn').disabled = false;
            
            log('üöÄ ServiceGuru Keep-Alive started', 'success');
            updateStatus('Starting...');
            
            // Initial ping
            pingServiceGuru();
            
            // Set up interval
            intervalId = setInterval(pingServiceGuru, PING_INTERVAL);
            
            log(`üì° Pinging every 2 minutes to keep ServiceGuru alive`, 'info');
        }

        function stopKeepAlive() {
            if (!isRunning) return;
            
            isRunning = false;
            document.getElementById('startBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
            
            if (intervalId) {
                clearInterval(intervalId);
                intervalId = null;
            }
            
            log('üõë ServiceGuru Keep-Alive stopped', 'error');
            updateStatus('Stopped');
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        // Warn user before leaving page
        window.addEventListener('beforeunload', function (e) {
            if (isRunning) {
                const message = 'ServiceGuru Keep-Alive is running. Closing this tab will stop the service.';
                e.returnValue = message;
                return message;
            }
        });

        // Auto-start on page load (optional)
        // startKeepAlive();
    </script>
</body>
</html>